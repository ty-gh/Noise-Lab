<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, viewport-fit=cover"
        />
        <meta name="theme-color" content="#f0f0f0" />
        
        <!-- PWAè¨­å®š -->
        <link rel="manifest" href="manifest.json">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="default">
        <meta name="apple-mobile-web-app-title" content="Noise Lab">
        <link rel="apple-touch-icon" href="app-icon.png">
        <link rel="icon" type="image/png" sizes="192x192" href="app-icon.png">
        <link rel="icon" type="image/png" sizes="512x512" href="app-icon.png">
        
        <title>é˜²éŸ³çª“å®Ÿé¨“å®¤ Noise Lab</title>
        <style>
            :root {
                --bg: #f0f0f0;
                --text: #333;
                --muted: #666;
                --shadow-dark: #d0d0d0;
                --shadow-light: #ffffff;
                --accent: #3a86ff;
                --ok: #33c27f;
                --ng: #ff5a5f;
                --card-radius: 18px;
                --btn-radius: 16px;
                --shadow-lg: 14px;
                --shadow-md: 10px;
                --shadow-sm: 6px;
                
                /* éŸ³æºåˆ¥ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
                --voice-base: #ff6b6b;
                --voice-active: #ff5252;
                --voice-glow: rgba(255, 107, 107, 0.4);
                
                --tv-base: #4ecdc4;
                --tv-active: #26a69a;
                --tv-glow: rgba(78, 205, 196, 0.4);
                
                --construction-base: #ffa726;
                --construction-active: #ff9800;
                --construction-glow: rgba(255, 167, 38, 0.4);
                
                --laundry-base: #ab47bc;
                --laundry-active: #9c27b0;
                --laundry-glow: rgba(171, 71, 188, 0.4);
                
                --rain-base: #42a5f5;
                --rain-active: #2196f3;
                --rain-glow: rgba(66, 165, 245, 0.4);
                
                --traffic-base: #66bb6a;
                --traffic-active: #4caf50;
                --traffic-glow: rgba(102, 187, 106, 0.4);
                
                /* å‹•çš„ã‚«ãƒ©ãƒ¼å¤‰æ•°ï¼ˆJavaScriptã§æ›´æ–°ï¼‰ */
                --dynamic-button-bg: var(--bg);
                --dynamic-button-shadow: var(--shadow-dark);
                --dynamic-glow-opacity: 0;
            }
            * {
                box-sizing: border-box;
            }
            html,
            body {
                margin: 0;
                padding: 0;
                background: var(--bg);
                color: var(--text);
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    "Hiragino Sans", "Noto Sans JP", "Helvetica Neue", Arial,
                    "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
                    sans-serif;
                -webkit-font-smoothing: antialiased;
                text-rendering: optimizeLegibility;
            }

            /* Neumorphism */
            .nm-raised {
                background: var(--bg);
                border-radius: var(--card-radius);
                box-shadow:
                    /* å¤–å´ã®å½±ã®ã¿ã§ã‚·ãƒ³ãƒ—ãƒ«ãªæµ®ãä¸ŠãŒã‚Šæ„Ÿ */
                    var(--shadow-sm) var(--shadow-sm) calc(var(--shadow-sm) * 2) var(--shadow-dark),
                    calc(var(--shadow-sm) * -1) calc(var(--shadow-sm) * -1) calc(var(--shadow-sm) * 2) var(--shadow-light);
            }
            .nm-inset {
                background: var(--bg);
                border-radius: var(--card-radius);
                box-shadow:
                    inset var(--shadow-md) var(--shadow-md)
                        calc(var(--shadow-md) * 1.6) var(--shadow-dark),
                    inset calc(var(--shadow-md) * -1)
                        calc(var(--shadow-md) * -1) calc(var(--shadow-md) * 1.6)
                        var(--shadow-light);
            }
            .chip {
                font-size: 12px;
                color: var(--muted);
                padding: 7px 10px;
                border-radius: 999px;
                background: var(--bg);
                box-shadow:
                    6px 6px 12px var(--shadow-dark),
                    -6px -6px 12px var(--shadow-light);
                line-height: 1;
            }

            /* App frame */
            .app {
                min-height: 100svh;
                max-width: 1200px;
                margin: 0 auto;
                display: grid;
                grid-template-rows: auto auto 1fr auto;
                gap: 8px;
                padding: 16px 16px 10px;
            }

            /* Header: title + compact BT */
            .topbar {
                position: relative;
                display: flex;
                align-items: center;
                gap: 12px;
                flex-wrap: wrap;
                padding: 8px 0;
            }
            .logo {
                height: 45px;
                width: auto;
                max-width: 300px;
                object-fit: contain;
                filter: drop-shadow(1px 1px 0 rgba(255, 255, 255, 0.8));
                position: absolute;
                top: 50%;
                left: 0;
                transform: translateY(-50%);
                z-index: 10;
            }
            .topbar h1 {
                margin: 0;
                margin-left: 310px;
                margin-top: 8px;
                font-size: 12px;
                font-weight: 400;
                letter-spacing: 0.2px;
                text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.8);
                color: var(--muted);
                opacity: 0.4;
            }
            .topbar .spacer {
                flex: 1 1 auto;
            }
            
            /* éŸ³å£°èª­ã¿è¾¼ã¿çŠ¶æ³ãƒãƒƒãƒ— */
            .loading-chip {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 6px 8px;
                border-radius: 999px;
                background: var(--bg);
                box-shadow:
                    6px 6px 12px var(--shadow-dark),
                    -6px -6px 12px var(--shadow-light);
                color: var(--muted);
                white-space: nowrap;
                line-height: 1;
                margin-right: 8px;
            }
            .loading-chip .loading-dot {
                width: 9px;
                height: 9px;
                border-radius: 50%;
                background: radial-gradient(
                    circle at 30% 30%,
                    #ffd8b3,
                    #ffa726
                );
                box-shadow:
                    inset 2px 2px 4px rgba(0, 0, 0, 0.08),
                    inset -2px -2px 4px rgba(255, 255, 255, 0.8),
                    0 0 0 2px rgba(0, 0, 0, 0.03);
                animation: loading-pulse 1.5s ease-in-out infinite;
            }
            .loading-chip .loading-dot.completed {
                background: radial-gradient(
                    circle at 30% 30%,
                    #b8ffd8,
                    #33c27f
                );
                animation: none;
            }
            .loading-chip .lbl {
                font-size: 12px;
                font-weight: 600;
                color: #333;
            }
            .loading-chip .progress {
                font-size: 11px;
                font-weight: 700;
                color: var(--accent);
                min-width: 24px;
                text-align: center;
            }
            @keyframes loading-pulse {
                0%, 100% {
                    opacity: 0.6;
                    transform: scale(1);
                }
                50% {
                    opacity: 1;
                    transform: scale(1.1);
                }
            }


            /* Sound panel (main 7å‰²)ã€‚å½±å´©ã‚Œé˜²æ­¢ã®ãŸã‚ååˆ†ãªå†…å´ä½™ç™½ã‚’ç¢ºä¿ */
            .sound-panel {
                padding: 15px; /* æ ç·šåˆ†ã‚’è€ƒæ…®ã—ã¦å°‘ã—å¢—ã‚„ã™ */
                display: flex;
                flex-direction: column;
                min-height: 0;
                border-radius: var(--card-radius);
                position: relative;
                background: linear-gradient(135deg, 
                    #b3e5fc 0%,
                    #c4f2d4 16.6%,
                    #fff4c4 33.3%,
                    #ffd4b3 50%,
                    #d6ccff 66.6%,
                    #f2c2e8 83.3%,
                    #ffcccb 100%);
            }
            
            /* å†…å´ã®èƒŒæ™¯ï¼ˆæ ç·šåŠ¹æœã‚’ä½œã‚‹ãŸã‚ï¼‰ */
            .sound-panel::before {
                content: '';
                position: absolute;
                top: 3px;
                left: 3px;
                right: 3px;
                bottom: 3px;
                background: var(--bg);
                border-radius: calc(var(--card-radius) - 3px);
                z-index: 0;
            }
            
            /* ãƒ‘ãƒãƒ«å†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å‰é¢ã« */
            .sound-panel > * {
                position: relative;
                z-index: 1;
            }
            .sound-scroll {
                overflow: auto;
                padding: 20px; /* ã‚ˆã‚Šä½™è£•ã®ã‚ã‚‹ä½™ç™½ã§ã‚°ãƒ­ãƒ¼åŠ¹æœã‚‚è€ƒæ…® */
            }
            .grid {
                display: grid;
                gap: 28px;
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                align-items: start;
            }

            /* ãƒœã‚¿ãƒ³: ãƒ‹ãƒ¥ãƒ¼ãƒ¢ãƒ«ãƒ•ã‚£ãƒƒã‚¯ + å‹•çš„è‰²å¤‰åŒ–å¯¾å¿œ */
            .nm-btn {
                appearance: none;
                border: none;
                width: 100%;
                background: var(--dynamic-button-bg);
                border-radius: var(--btn-radius);
                box-shadow:
                    /* ãƒœã‚¿ãƒ³è‡ªä½“ã®ãƒ‹ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯åŠ¹æœï¼ˆæ§ãˆã‚ï¼‰ */
                    6px 6px 12px var(--dynamic-button-shadow),
                    -6px -6px 12px var(--shadow-light),
                    /* ãƒˆãƒ¬ãƒ¼ã«æŠ•ã˜ã‚‹è‡ªç„¶ãªå½± */
                    0 2px 8px rgba(0, 0, 0, 0.08),
                    0 1px 4px rgba(0, 0, 0, 0.04);
                padding: 16px;
                cursor: pointer;
                color: var(--text);
                text-align: center;
                transition: 
                    box-shadow 0.15s ease,
                    background-color 0.3s ease,
                    transform 0.15s ease;
                aspect-ratio: 1;
                min-height: 0;
                position: relative;
                overflow: hidden;
            }
            
            /* éŸ³æºåˆ¥ã®åŸºæœ¬è‰²è¨­å®š */
            .nm-btn[data-sound="voice"] {
                --sound-base: var(--voice-base);
                --sound-active: var(--voice-active);
                --sound-glow: var(--voice-glow);
            }
            .nm-btn[data-sound="tv"] {
                --sound-base: var(--tv-base);
                --sound-active: var(--tv-active);
                --sound-glow: var(--tv-glow);
            }
            .nm-btn[data-sound="construction"] {
                --sound-base: var(--construction-base);
                --sound-active: var(--construction-active);
                --sound-glow: var(--construction-glow);
            }
            .nm-btn[data-sound="laundry"] {
                --sound-base: var(--laundry-base);
                --sound-active: var(--laundry-active);
                --sound-glow: var(--laundry-glow);
            }
            .nm-btn[data-sound="rain"] {
                --sound-base: var(--rain-base);
                --sound-active: var(--rain-active);
                --sound-glow: var(--rain-glow);
            }
            .nm-btn[data-sound="traffic"] {
                --sound-base: var(--traffic-base);
                --sound-active: var(--traffic-active);
                --sound-glow: var(--traffic-glow);
            }
            
            /* å†ç”ŸçŠ¶æ…‹æ™‚ã®è‰²å¤‰åŒ–ã¨ã‚°ãƒ­ãƒ¼åŠ¹æœï¼ˆå¼·åŒ–ç‰ˆï¼‰ */
            .nm-btn.is-active {
                background: radial-gradient(ellipse at 30% 30%, 
                    color-mix(in srgb, var(--sound-base) 30%, var(--bg) 70%) 0%,
                    color-mix(in srgb, var(--sound-base) 20%, var(--bg) 80%) 40%,
                    color-mix(in srgb, var(--sound-base) 12%, var(--bg) 88%) 70%,
                    color-mix(in srgb, var(--sound-active) 6%, var(--bg) 94%) 90%,
                    var(--bg) 100%);
                box-shadow:
                    /* ã¸ã“ã¿åŠ¹æœï¼ˆå†…å´ã®å½±ï¼‰ */
                    inset 4px 4px 8px var(--shadow-dark),
                    inset -4px -4px 8px var(--shadow-light),
                    /* ã‚ãšã‹ãªå¤–å´ã®å½±ã§ç«‹ä½“æ„Ÿã‚’ç¶­æŒ */
                    1px 1px 3px rgba(0, 0, 0, 0.05);
                transform: scale(0.98);
                animation: pulse-glow 2s ease-in-out infinite;
            }
            
            /* éŸ³é‡é€£å‹•ã‚°ãƒ­ãƒ¼ */
            .nm-btn.is-active::before {
                content: '';
                position: absolute;
                top: -2px;
                left: -2px;
                right: -2px;
                bottom: -2px;
                background: radial-gradient(circle, var(--sound-glow), transparent 70%);
                border-radius: var(--btn-radius);
                opacity: var(--dynamic-glow-opacity);
                z-index: -2;
                transition: opacity 0.1s ease;
            }
            
            /* ã‚ªãƒ¼ãƒ©åŠ¹æœï¼ˆå†ç”Ÿä¸­ã®å…‰ã®è¼ªï¼‰ */
            .nm-btn.is-active::after {
                content: '';
                position: absolute;
                top: -15px;
                left: -15px;
                right: -15px;
                bottom: -15px;
                border: 3px solid var(--sound-base);
                border-radius: calc(var(--btn-radius) + 12px);
                opacity: 0.6;
                z-index: -1;
                animation: pulse-aura 2.5s ease-in-out infinite;
                box-shadow: 0 0 15px var(--sound-glow);
            }
            
            /* ãƒªãƒƒãƒ—ãƒ«åŠ¹æœã®åŸºæœ¬æ§‹é€  */
            .ripple-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border-radius: var(--btn-radius);
                overflow: hidden;
                pointer-events: none;
                z-index: 1;
            }
            
            .ripple {
                position: absolute;
                background: radial-gradient(circle, var(--sound-base), transparent 70%);
                border-radius: 50%;
                transform: scale(0);
                animation: ripple-animation 0.6s ease-out forwards;
                pointer-events: none;
            }
            
            /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
            @keyframes pulse-aura {
                0%, 100% {
                    transform: scale(1);
                    opacity: 0.4;
                    box-shadow: 0 0 10px var(--sound-glow);
                }
                50% {
                    transform: scale(1.15);
                    opacity: 0.8;
                    box-shadow: 0 0 25px var(--sound-glow);
                }
            }
            
            @keyframes pulse-glow {
                0%, 100% {
                    box-shadow:
                        4px 4px 8px var(--shadow-dark),
                        -4px -4px 8px var(--shadow-light),
                        0 3px 12px rgba(0, 0, 0, 0.12),
                        0 1px 6px rgba(0, 0, 0, 0.06);
                }
                50% {
                    box-shadow:
                        4px 4px 8px var(--shadow-dark),
                        -4px -4px 8px var(--shadow-light),
                        0 3px 12px rgba(0, 0, 0, 0.12),
                        0 1px 6px rgba(0, 0, 0, 0.06);
                }
            }
            
            @keyframes ripple-animation {
                0% {
                    transform: scale(0);
                    opacity: 1;
                }
                50% {
                    opacity: 0.6;
                }
                100% {
                    transform: scale(2.5);
                    opacity: 0;
                }
            }
            
            /* ã‚¿ãƒƒãƒæ™‚ã®ç‰©ç†çš„æŠ¼ã—è¾¼ã¿åŠ¹æœ */
            .nm-btn:active,
            .nm-btn.touching {
                transform: scale(0.96) translateZ(0);
                box-shadow:
                    inset 8px 8px 16px var(--shadow-dark),
                    inset -8px -8px 16px var(--shadow-light),
                    0 0 0 rgba(0,0,0,0); /* å¤–å´ã®å½±ã‚’å‰Šé™¤ã§æŠ¼ã—è¾¼ã¿æ„Ÿ */
                transition-duration: 0.1s; /* ã‚ˆã‚Šç´ æ—©ã„åå¿œ */
            }
            
            /* é€šå¸¸çŠ¶æ…‹ã¸ã®å¾©å¸°æ™‚ã®ã‚¹ãƒ ãƒ¼ã‚ºãªæˆ»ã‚Š */
            .nm-btn:not(:active):not(.touching) {
                transition-duration: 0.2s; /* æˆ»ã‚Šã¯å°‘ã—ã‚†ã£ãã‚Š */
            }
            
            /* å†ç”Ÿä¸­ãƒœã‚¿ãƒ³ã®ç‰¹åˆ¥ãªæŠ¼ã—è¾¼ã¿åŠ¹æœ */
            .nm-btn.is-active:active,
            .nm-btn.is-active.touching {
                transform: scale(0.94) translateZ(0);
                box-shadow:
                    /* è»½ã„æŠ¼ã—è¾¼ã¿æ„Ÿï¼ˆãƒˆãƒ¬ãƒ¼ä¸Šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‰ã—ãï¼‰ */
                    inset 3px 3px 6px var(--shadow-dark),
                    inset -3px -3px 6px var(--shadow-light),
                    /* è–„ã„å½±ã‚’æ®‹ã—ã¦ãƒˆãƒ¬ãƒ¼ã¨ã®è·é›¢æ„Ÿã‚’ç¶­æŒ */
                    0 1px 3px rgba(0, 0, 0, 0.06),
                    0 0 8px var(--sound-glow); /* å†ç”Ÿä¸­ã¯è–„ã„ã‚°ãƒ­ãƒ¼ã‚’æ®‹ã™ */
            }
            
            .nm-btn:focus-visible {
                outline: 2px solid rgba(58, 134, 255, 0.75);
                outline-offset: 3px;
                border-radius: 14px;
            }
            
            /* ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–çŠ¶æ…‹ */
            .nm-btn:disabled {
                opacity: 0.4;
                cursor: not-allowed;
                pointer-events: none;
                box-shadow:
                    2px 2px 6px var(--shadow-dark),
                    -2px -2px 6px var(--shadow-light);
                transform: none;
            }
            
            .nm-btn:disabled .tap-message {
                display: none;
            }

            .sound-btn {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-align: center;
                gap: 6px;
                height: 100%;
                position: relative;
            }
            
            /* ä¸Šæ®µï¼šdBå€¤ã‚’ã‚¢ã‚¤ã‚³ãƒ³ã®ä¸Šã«é…ç½® */
            .sound-btn .top-row {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 2px;
                width: 100%;
                margin-top: -40px;
            }
            .sound-btn .icon {
                width: 56px;
                height: 56px;
                display: grid;
                place-items: center;
                font-size: 36px;
                line-height: 1;
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
                border-radius: 10px;
                background-color: transparent;
                opacity: 0.85;
                transition: opacity 0.2s ease;
            }
            
            .nm-btn:hover .icon,
            .nm-btn.is-active .icon {
                opacity: 1;
            }
            
            /* å„éŸ³å£°ç¨®åˆ¥ã®ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒ */
            .sound-btn .icon[data-sound="voice"] {
                background-image: url('images/voice.png');
            }
            .sound-btn .icon[data-sound="tv"] {
                background-image: url('images/tv.png');
            }
            .sound-btn .icon[data-sound="construction"] {
                background-image: url('images/construction.png');
            }
            .sound-btn .icon[data-sound="laundry"] {
                background-image: url('images/laundry.png');
            }
            .sound-btn .icon[data-sound="rain"] {
                background-image: url('images/rain.png');
            }
            .sound-btn .icon[data-sound="traffic"] {
                background-image: url('images/traffic.png');
            }
            
            /* ç”»åƒèª­ã¿è¾¼ã¿å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆçµµæ–‡å­—ï¼‰ */
            .sound-btn .icon[data-sound="voice"]:after {
                content: "ğŸ’¬";
            }
            .sound-btn .icon[data-sound="tv"]:after {
                content: "ğŸ“º";
            }
            .sound-btn .icon[data-sound="construction"]:after {
                content: "ğŸš§";
            }
            .sound-btn .icon[data-sound="laundry"]:after {
                content: "ğŸ§º";
            }
            .sound-btn .icon[data-sound="rain"]:after {
                content: "ğŸŒ§ï¸";
            }
            .sound-btn .icon[data-sound="traffic"]:after {
                content: "ğŸš—";
            }
            
            /* ç”»åƒãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚ŒãŸå ´åˆã¯çµµæ–‡å­—ã‚’éè¡¨ç¤º */
            .sound-btn .icon[data-sound]:after {
                position: absolute;
                font-size: 32px;
                opacity: 0;
                z-index: -1;
                transition: opacity 0.2s ease;
            }
            .sound-btn .text {
                display: flex;
                flex-direction: column;
                justify-content: center;
                min-width: 0;
                gap: 4px;
                margin-top: 0px;
            }
            .sound-btn .title {
                font-weight: 700;
                line-height: 1.2;
                font-size: 14px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            /* å„ãƒœã‚¿ãƒ³å†…ã®æ³¢å½¢è¡¨ç¤ºé ˜åŸŸï¼ˆçµ±ä¸€ã•ã‚ŒãŸãƒã‚ªãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ï¼‰ */
            .sound-btn .mini-wave {
                position: absolute;
                bottom: 8px;
                left: 8px;
                right: 8px;
                width: calc(100% - 16px);
                height: 28px;
                border-radius: 8px;
                background: var(--bg);
                box-shadow:
                    inset 3px 3px 6px var(--shadow-dark),
                    inset -3px -3px 6px var(--shadow-light);
                overflow: hidden;
                opacity: 0;
                transition: 
                    opacity 0.4s ease,
                    height 0.3s ease,
                    box-shadow 0.3s ease;
            }
            
            .nm-btn.is-active .mini-wave {
                opacity: 1;
                height: 32px;
                box-shadow:
                    inset 3px 3px 6px var(--shadow-dark),
                    inset -3px -3px 6px var(--shadow-light);
            }
            
            .mini-wave canvas {
                width: 100%;
                height: 100%;
                display: block;
                border-radius: 6px;
            }
            
            /* dBå€¤ã®è¡¨ç¤ºï¼ˆã‚¢ã‚¤ã‚³ãƒ³ä¸Šéƒ¨é…ç½®ãƒ»çµ±ä¸€ã•ã‚ŒãŸãƒã‚ªãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ï¼‰ */
            .db-display {
                font-size: 15px;
                font-weight: 700;
                color: var(--text);
                background: var(--bg);
                padding: 7px 12px;
                border-radius: 8px;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s ease, visibility 0.3s ease, box-shadow 0.3s ease;
                pointer-events: none;
                min-width: 46px;
                text-align: center;
                line-height: 1.1;
                text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.9);
                box-shadow: 
                    /* çµ±ä¸€ã•ã‚ŒãŸãƒã‚ªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯å‡¹ã¿åŠ¹æœ */
                    inset 3px 3px 6px var(--shadow-dark),
                    inset -3px -3px 6px var(--shadow-light);
                flex-shrink: 0;
            }
            
            /* ã“ã“ã‚’ã‚¿ãƒƒãƒ—ï¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
            .tap-message {
                font-size: 11px;
                font-weight: 600;
                color: var(--accent);
                background: linear-gradient(145deg, #e8f2ff, #f0f7ff);
                padding: 4px 8px;
                border-radius: 10px;
                text-align: center;
                line-height: 1.2;
                text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.9);
                box-shadow: 
                    2px 2px 4px var(--shadow-dark),
                    -2px -2px 4px var(--shadow-light);
                opacity: 1;
                visibility: visible;
                transition: opacity 0.3s ease, visibility 0.3s ease;
                flex-shrink: 0;
                animation: gentle-pulse 2s ease-in-out infinite;
                position: absolute;
                bottom: 40px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 2;
            }
            
            /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: å„ªã—ã„ç‚¹æ»… */
            @keyframes gentle-pulse {
                0%, 100% {
                    opacity: 0.8;
                }
                50% {
                    opacity: 1;
                }
            }
            
            /* å†ç”Ÿä¸­ã¯ã‚¿ãƒƒãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤º */
            .nm-btn.is-active .tap-message {
                opacity: 0;
                visibility: hidden;
            }
            
            /* å†ç”Ÿä¸­ã®ã¿dBå€¤ã‚’è¡¨ç¤º */
            .nm-btn.is-active .db-display {
                opacity: 1;
                visibility: visible;
            }
            
            /* éŸ³æºåˆ¥ã®dBè¡¨ç¤ºè‰²èª¿æ•´ï¼ˆçµ±ä¸€ã•ã‚ŒãŸãƒã‚ªãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ï¼‰ */
            .nm-btn[data-sound="voice"].is-active .db-display {
                background: color-mix(in srgb, var(--voice-base) 6%, var(--bg) 94%);
                color: #555555;
                box-shadow: 
                    inset 3px 3px 6px color-mix(in srgb, var(--voice-base) 8%, var(--shadow-dark) 92%),
                    inset -3px -3px 6px var(--shadow-light),
                    0 0 6px rgba(255, 107, 107, 0.08);
            }
            .nm-btn[data-sound="tv"].is-active .db-display {
                background: color-mix(in srgb, var(--tv-base) 6%, var(--bg) 94%);
                color: #555555;
                box-shadow: 
                    inset 3px 3px 6px color-mix(in srgb, var(--tv-base) 8%, var(--shadow-dark) 92%),
                    inset -3px -3px 6px var(--shadow-light),
                    0 0 6px rgba(78, 205, 196, 0.08);
            }
            .nm-btn[data-sound="construction"].is-active .db-display {
                background: color-mix(in srgb, var(--construction-base) 6%, var(--bg) 94%);
                color: #555555;
                box-shadow: 
                    inset 3px 3px 6px color-mix(in srgb, var(--construction-base) 8%, var(--shadow-dark) 92%),
                    inset -3px -3px 6px var(--shadow-light),
                    0 0 6px rgba(255, 167, 38, 0.08);
            }
            .nm-btn[data-sound="laundry"].is-active .db-display {
                background: color-mix(in srgb, var(--laundry-base) 6%, var(--bg) 94%);
                color: #555555;
                box-shadow: 
                    inset 3px 3px 6px color-mix(in srgb, var(--laundry-base) 8%, var(--shadow-dark) 92%),
                    inset -3px -3px 6px var(--shadow-light),
                    0 0 6px rgba(171, 71, 188, 0.08);
            }
            .nm-btn[data-sound="rain"].is-active .db-display {
                background: color-mix(in srgb, var(--rain-base) 6%, var(--bg) 94%);
                color: #555555;
                box-shadow: 
                    inset 3px 3px 6px color-mix(in srgb, var(--rain-base) 8%, var(--shadow-dark) 92%),
                    inset -3px -3px 6px var(--shadow-light),
                    0 0 6px rgba(66, 165, 245, 0.08);
            }
            .nm-btn[data-sound="traffic"].is-active .db-display {
                background: color-mix(in srgb, var(--traffic-base) 6%, var(--bg) 94%);
                color: #555555;
                box-shadow: 
                    inset 3px 3px 6px color-mix(in srgb, var(--traffic-base) 8%, var(--shadow-dark) 92%),
                    inset -3px -3px 6px var(--shadow-light),
                    0 0 6px rgba(102, 187, 106, 0.08);
            }

            footer.note {
                font-size: 11px;
                color: var(--muted);
                text-align: center;
                padding-bottom: 6px;
            }
            /* ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–è¨­å®šæ™‚ã®é…æ…® */
            @media (prefers-reduced-motion: reduce) {
                .nm-btn {
                    transition: none;
                }
                .nm-btn:active,
                .nm-btn.touching {
                    transform: scale(0.98); /* è»½å¾®ãªå¤‰åŒ–ã®ã¿æ®‹ã™ */
                    transition: none;
                }
                .nm-btn.is-active::after {
                    animation: none; /* ã‚ªãƒ¼ãƒ©ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ– */
                }
                .ripple {
                    animation: none; /* ãƒªãƒƒãƒ—ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ– */
                }
                .sound-btn .icon {
                    transition: none;
                }
                .sound-btn .icon[data-sound]:after {
                    transition: none;
                }
                .sound-btn .mini-wave {
                    transition: none;
                }
            }
            
            /* é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
            @media (prefers-contrast: high) {
                .nm-btn:active,
                .nm-btn.touching {
                    outline: 2px solid;
                    outline-offset: -2px;
                }
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå‘ã‘ã‚µã‚¤ã‚ºèª¿æ•´ */
            @media (max-width: 480px) {
                .grid {
                    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                    gap: 18px;
                }
                .nm-btn {
                    padding: 12px;
                }
                .sound-btn .icon {
                    width: 44px;
                    height: 44px;
                    background-size: contain;
                }
                .sound-btn .icon[data-sound]:after {
                    font-size: 26px;
                }
                .sound-btn .title {
                    font-size: 12px;
                }
                .sound-btn .mini-wave {
                    height: 12px; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯æ³¢å½¢ã‚’å°ã•ã */
                }
                
                /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®dBè¡¨ç¤ºã‚µã‚¤ã‚ºèª¿æ•´ */
                .db-display {
                    font-size: 13px;
                    padding: 5px 8px;
                    min-width: 40px;
                    border-radius: 6px;
                }
                
                .sound-btn .top-row {
                    gap: 1px;
                }
            }
            
            /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå‘ã‘æœ€é©åŒ– */
            @media (min-width: 768px) and (max-width: 1024px) {
                .sound-btn .icon {
                    width: 52px;
                    height: 52px;
                }
                .sound-btn .icon[data-sound]:after {
                    font-size: 30px;
                }
                .sound-btn .mini-wave {
                    height: 30px; /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ã¯æ³¢å½¢ã‚’å¤§ãã */
                }
                .nm-btn.is-active .mini-wave {
                    height: 36px;
                }
                .grid {
                    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                    gap: 32px;
                }
                .sound-scroll {
                    padding: 28px;
                }
            }
            
            /* å¤§ç”»é¢å‘ã‘ */
            @media (min-width: 1200px) {
                .sound-btn .icon {
                    width: 60px;
                    height: 60px;
                }
                .sound-btn .icon[data-sound]:after {
                    font-size: 36px;
                }
                .sound-btn .mini-wave {
                    height: 32px; /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã¯æœ€å¤§ã‚µã‚¤ã‚º */
                }
                .nm-btn.is-active .mini-wave {
                    height: 40px;
                }
                .grid {
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 36px;
                }
            }
        </style>
    </head>
    <body>
        <div class="app">
            <header class="topbar">
                <img src="images/logo.png" alt="Noise Lab ãƒ­ã‚´" class="logo">
                <h1>powered by ICT-PARK 0.4.3</h1>
                <div class="spacer"></div>
                <!-- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿çŠ¶æ³è¡¨ç¤º -->
                <div id="loadingStatus" class="loading-chip" aria-label="éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿çŠ¶æ³" style="display: block;">
                    <span class="loading-dot" aria-hidden="true"></span>
                    <span id="loadingLabel" class="lbl">éŸ³å£°èª­ã¿è¾¼ã¿ä¸­...</span>
                    <span id="loadingProgress" class="progress">0/6</span>
                </div>
            </header>
            <!-- ãƒ¡ã‚¤ãƒ³ï¼šå†ç”Ÿãƒœã‚¿ãƒ³ï¼ˆç´„7å‰²ï¼‰ -->
            <section
                class="sound-panel"
                aria-label="ç”Ÿæ´»éŸ³ã®å†ç”Ÿãƒœã‚¿ãƒ³"
            >
                <div class="sound-scroll">
                    <div class="grid">
                        <button
                            class="nm-btn sound-btn"
                            data-sound="voice"
                            aria-pressed="false"
                            disabled
                        >
                            <div class="ripple-container"></div>
                            <div class="top-row">
                                <div class="db-display" data-db="voice" aria-hidden="true">-âˆ</div>
                                <div class="icon" data-sound="voice" aria-hidden="true"></div>
                            </div>
                            <div class="text">
                                <div class="title">è©±ã—å£°</div>
                                <div class="tap-message">ã“ã“ã‚’ã‚¿ãƒƒãƒ—ï¼</div>
                                <div class="mini-wave">
                                    <canvas data-wave="voice" aria-hidden="true"></canvas>
                                </div>
                            </div>
                        </button>
                        <button
                            class="nm-btn sound-btn"
                            data-sound="tv"
                            aria-pressed="false"
                            disabled
                        >
                            <div class="ripple-container"></div>
                            <div class="top-row">
                                <div class="db-display" data-db="tv" aria-hidden="true">-âˆ</div>
                                <div class="icon" data-sound="tv" aria-hidden="true"></div>
                            </div>
                            <div class="text">
                                <div class="title">ãƒ†ãƒ¬ãƒ“éŸ³</div>
                                <div class="mini-wave">
                                    <canvas data-wave="tv" aria-hidden="true"></canvas>
                                </div>
                            </div>
                        </button>
                        <button
                            class="nm-btn sound-btn"
                            data-sound="construction"
                            aria-pressed="false"
                            disabled
                        >
                            <div class="ripple-container"></div>
                            <div class="top-row">
                                <div class="db-display" data-db="construction" aria-hidden="true">-âˆ</div>
                                <div class="icon" data-sound="construction" aria-hidden="true"></div>
                            </div>
                            <div class="text">
                                <div class="title">å·¥äº‹éŸ³</div>
                                <div class="mini-wave">
                                    <canvas data-wave="construction" aria-hidden="true"></canvas>
                                </div>
                            </div>
                        </button>
                        <button
                            class="nm-btn sound-btn"
                            data-sound="laundry"
                            aria-pressed="false"
                            disabled
                        >
                            <div class="ripple-container"></div>
                            <div class="top-row">
                                <div class="db-display" data-db="laundry" aria-hidden="true">-âˆ</div>
                                <div class="icon" data-sound="laundry" aria-hidden="true"></div>
                            </div>
                            <div class="text">
                                <div class="title">æ´—æ¿¯æ©Ÿ</div>
                                <div class="mini-wave">
                                    <canvas data-wave="laundry" aria-hidden="true"></canvas>
                                </div>
                            </div>
                        </button>
                        <button
                            class="nm-btn sound-btn"
                            data-sound="rain"
                            aria-pressed="false"
                            disabled
                        >
                            <div class="ripple-container"></div>
                            <div class="top-row">
                                <div class="db-display" data-db="rain" aria-hidden="true">-âˆ</div>
                                <div class="icon" data-sound="rain" aria-hidden="true"></div>
                            </div>
                            <div class="text">
                                <div class="title">é›¨éŸ³</div>
                                <div class="mini-wave">
                                    <canvas data-wave="rain" aria-hidden="true"></canvas>
                                </div>
                            </div>
                        </button>
                        <button
                            class="nm-btn sound-btn"
                            data-sound="traffic"
                            aria-pressed="false"
                            disabled
                        >
                            <div class="ripple-container"></div>
                            <div class="top-row">
                                <div class="db-display" data-db="traffic" aria-hidden="true">-âˆ</div>
                                <div class="icon" data-sound="traffic" aria-hidden="true"></div>
                            </div>
                            <div class="text">
                                <div class="title">äº¤é€šé¨’éŸ³</div>
                                <div class="mini-wave">
                                    <canvas data-wave="traffic" aria-hidden="true"></canvas>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>
            </section>

            <footer class="note">
                è¡¨ç¤ºdBã¯ç›¸å¯¾å€¤ï¼ˆdBFSï¼‰ã€‚å®Ÿéš›ã®é¨’éŸ³è¨ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚OSã®Bluetoothè¨­å®šã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç›´æ¥é–‹ã‘ã¾ã›ã‚“ã€‚
            </footer>
        </div>

        <script>
            // Audio + Analyzer
            let audioCtx;
            let masterGain, analyser;
            let audioBuffers = {};
            
            // è¤‡æ•°éŸ³æºåŒæ™‚å†ç”Ÿç®¡ç†
            let activeSounds = new Map(); // soundName -> { stopFn, gainNode, sourceNode, analyser }
            
            // ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ç®¡ç†
            let preloadStatus = {
                totalFiles: 6,
                loadedFiles: 0,
                isComplete: false,
                files: ['voice', 'tv', 'construction', 'laundry', 'rain', 'traffic']
            };
            
            // å€‹åˆ¥éŸ³æºã®æ³¢å½¢è¡¨ç¤ºç®¡ç†
            let miniWaveCanvases = new Map(); // soundName -> { canvas, ctx, dataArray }
            let miniWaveData = new Map(); // soundName -> frequencyData
            
            // å€‹åˆ¥éŸ³æºã®dBè¡¨ç¤ºç®¡ç†
            let dbDisplayElements = new Map(); // soundName -> dbElement
            
            // ç¶™ç¶šçš„æ³¢ç´‹åŠ¹æœç®¡ç†
            let continuousRipples = new Map(); // soundName -> intervalId
            
            // Canvasæœ€é©åŒ–: ãƒ‡ãƒã‚¤ã‚¹ãƒ”ã‚¯ã‚»ãƒ«æ¯”ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
            const devicePixelRatio = window.devicePixelRatio || 1;

            function ensureAudio() {
                if (audioCtx) return;
                
                console.log('AudioContextã‚’åˆæœŸåŒ–ä¸­...');
                
                try {
                    audioCtx = new (window.AudioContext ||
                        window.webkitAudioContext)();
                    
                    console.log('AudioContextçŠ¶æ…‹:', audioCtx.state);
                    
                    masterGain = audioCtx.createGain();
                    masterGain.gain.value = 0.9;

                    analyser = audioCtx.createAnalyser();
                    analyser.fftSize = 2048;
                    analyser.smoothingTimeConstant = 0.85;

                    masterGain.connect(analyser);

                    // ç›´æ¥ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã«å‡ºåŠ›
                    analyser.connect(audioCtx.destination);
                    
                    console.log('AudioContextåˆæœŸåŒ–å®Œäº†');
                } catch (error) {
                    console.error('AudioContextåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            async function loadAudioFile(url) {
                try {
                    console.log(`ãƒ•ã‚§ãƒƒãƒé–‹å§‹: ${url}`);
                    const response = await fetch(url);
                    console.log(`ãƒ•ã‚§ãƒƒãƒçµæœ: ${response.status} ${response.statusText}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const arrayBuffer = await response.arrayBuffer();
                    console.log(`ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ${arrayBuffer.byteLength} bytes`);
                    
                    // AudioContextãŒãªã„å ´åˆã¯åˆæœŸåŒ–
                    if (!audioCtx) {
                        console.log('AudioContextã‚’åˆæœŸåŒ–ä¸­...');
                        ensureAudio();
                    }
                    
                    const buffer = await audioCtx.decodeAudioData(arrayBuffer);
                    console.log(`ãƒ‡ã‚³ãƒ¼ãƒ‰æˆåŠŸ: ${buffer.duration.toFixed(2)}ç§’`);
                    return buffer;
                } catch (error) {
                    console.error(`éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${url}`, error);
                    return null;
                }
            }

            // ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰çŠ¶æ³ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
            function updatePreloadStatus() {
                const loadingLabel = document.getElementById('loadingLabel');
                const loadingProgress = document.getElementById('loadingProgress');
                const loadingDot = document.querySelector('.loading-dot');
                const loadingChip = document.getElementById('loadingStatus');
                
                if (!loadingLabel || !loadingProgress || !loadingDot || !loadingChip) return;
                
                loadingProgress.textContent = `${preloadStatus.loadedFiles}/${preloadStatus.totalFiles}`;
                
                if (preloadStatus.isComplete) {
                    loadingLabel.textContent = 'éŸ³å£°æº–å‚™å®Œäº†!';
                    loadingDot.classList.add('completed');
                    
                    // 2ç§’å¾Œã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒƒãƒ—ã‚’éè¡¨ç¤º
                    setTimeout(() => {
                        loadingChip.style.display = 'none';
                    }, 2000);
                    
                    // ã™ã¹ã¦ã®å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                    enableAllSoundButtons();
                }
            }
            
            // ã™ã¹ã¦ã®å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            function enableAllSoundButtons() {
                const buttons = document.querySelectorAll('.sound-btn');
                buttons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.cursor = 'pointer';
                    btn.style.opacity = '1';
                    
                    // ã€Œã“ã“ã‚’ã‚¿ãƒƒãƒ—ï¼ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    const tapMessage = btn.querySelector('.tap-message');
                    if (tapMessage) {
                        tapMessage.style.opacity = '';
                        tapMessage.style.visibility = '';
                    }
                });
            }

            // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã®æ¤œçŸ¥ã¨ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
            function handleOfflineState() {
                console.log('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚’æ¤œçŸ¥ã—ã¾ã—ãŸã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸéŸ³å£°ã§å‹•ä½œã—ã¾ã™ã€‚');
                
                // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                enableAllSoundButtons();
                
                // èª­ã¿è¾¼ã¿çŠ¶æ³ã‚’æ›´æ–°
                const loadingLabel = document.getElementById('loadingLabel');
                const loadingProgress = document.getElementById('loadingProgress');
                const loadingDot = document.querySelector('.loading-dot');
                
                if (loadingLabel && loadingProgress && loadingDot) {
                    loadingLabel.textContent = 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰';
                    loadingProgress.textContent = 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥';
                    loadingDot.classList.add('completed');
                    
                    // ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰å®Œäº†æ‰±ã„ã«ã™ã‚‹
                    preloadStatus.isComplete = true;
                }
            }

            // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã®ç›£è¦–
            window.addEventListener('online', () => {
                console.log('ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«å¾©å¸°ã—ã¾ã—ãŸ');
                // å¿…è¦ã«å¿œã˜ã¦éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†èª­ã¿è¾¼ã¿
                if (!preloadStatus.isComplete) {
                    preloadAudioFiles();
                }
            });

            window.addEventListener('offline', () => {
                console.log('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã«ãªã‚Šã¾ã—ãŸ');
                handleOfflineState();
            });

            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã‚’ç¢ºèª
            function checkInitialNetworkState() {
                if (!navigator.onLine) {
                    console.log('åˆæœŸçŠ¶æ…‹ï¼šã‚ªãƒ•ãƒ©ã‚¤ãƒ³');
                    handleOfflineState();
                } else {
                    console.log('åˆæœŸçŠ¶æ…‹ï¼šã‚ªãƒ³ãƒ©ã‚¤ãƒ³');
                }
            }
            
            // ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ç”¨ã®éåŒæœŸé–¢æ•°ï¼ˆå€‹åˆ¥è¿½è·¡ç‰ˆï¼‰
            async function preloadAudioFiles() {
                console.log('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã™...');
                
                // å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é †ç•ªã«èª­ã¿è¾¼ã‚“ã§é€²æ—ã‚’è¡¨ç¤º
                for (const sound of preloadStatus.files) {
                    try {
                        console.log(`èª­ã¿è¾¼ã¿ä¸­: ${sound}.mp3`);
                        const buffer = await loadAudioFile(`sounds/${sound}.mp3`);
                        
                        if (buffer) {
                            audioBuffers[sound] = buffer;
                            preloadStatus.loadedFiles++;
                            console.log(`æˆåŠŸ: ${sound}.mp3 (é€²æ—: ${preloadStatus.loadedFiles}/${preloadStatus.totalFiles})`);
                            updatePreloadStatus();
                        } else {
                            console.warn(`éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${sound}.mp3`);
                            // å¤±æ•—ã—ã¦ã‚‚ã‚«ã‚¦ãƒ³ãƒˆã‚’é€²ã‚ã‚‹
                            preloadStatus.loadedFiles++;
                            updatePreloadStatus();
                        }
                    } catch (error) {
                        console.error(`ã‚¨ãƒ©ãƒ¼: ${sound}.mp3`, error);
                        // ã‚¨ãƒ©ãƒ¼ã§ã‚‚ã‚«ã‚¦ãƒ³ãƒˆã‚’é€²ã‚ã‚‹
                        preloadStatus.loadedFiles++;
                        updatePreloadStatus();
                    }
                }
                
                // å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†å®Œäº†
                preloadStatus.isComplete = true;
                console.log('ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰å®Œäº†!');
                updatePreloadStatus();
                
                // Service Workerã«éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¦æ±‚
                setTimeout(() => {
                    requestAudioPreCache().catch(error => {
                        console.warn('Audio pre-cache request failed:', error);
                    });
                }, 1000);
            }

            function makeBufferSource(buffer, loop = true) {
                const src = audioCtx.createBufferSource();
                src.buffer = buffer;
                src.loop = loop;
                return src;
            }

            // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿï¼ˆå€‹åˆ¥éŸ³æºè§£æå¯¾å¿œï¼‰
            function buildFromAudioFile(soundName) {
                const buffer = audioBuffers[soundName];
                if (!buffer) {
                    console.error(`éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${soundName}`);
                    return null;
                }
                
                const src = makeBufferSource(buffer, true);
                const gain = audioCtx.createGain();
                gain.gain.value = 0.7;
                
                // å€‹åˆ¥éŸ³æºç”¨ã®ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ä½œæˆï¼ˆPhase1: æ„Ÿåº¦å‘ä¸Šï¼‰
                const soundAnalyser = audioCtx.createAnalyser();
                soundAnalyser.fftSize = 512; // ãƒŸãƒ‹æ³¢å½¢ç”¨ã«è»½é‡åŒ–
                soundAnalyser.smoothingTimeConstant = 0.6; // ã‚ˆã‚Šæ•æ„Ÿã«åå¿œï¼ˆ0.8 â†’ 0.6ï¼‰
                
                // æ¥ç¶š: src -> gain -> [analyser, masterGain]
                src.connect(gain);
                gain.connect(soundAnalyser);
                gain.connect(masterGain);
                
                src.start();
                
                const stopFn = () => {
                    try {
                        src.stop();
                        src.disconnect();
                        gain.disconnect();
                        soundAnalyser.disconnect();
                    } catch (e) {}
                };
                
                return {
                    stopFn: stopFn,
                    gainNode: gain,
                    sourceNode: src,
                    analyser: soundAnalyser
                };
            }

            const SOUND_BUILDERS = {
                voice: () => buildFromAudioFile('voice'),
                tv: () => buildFromAudioFile('tv'),
                construction: () => buildFromAudioFile('construction'),
                laundry: () => buildFromAudioFile('laundry'),
                rain: () => buildFromAudioFile('rain'),
                traffic: () => buildFromAudioFile('traffic'),
            };

            // è¤‡æ•°éŸ³æºå¯¾å¿œã®æ–°ã—ã„å†ç”Ÿ/åœæ­¢é–¢æ•°
            async function startSound(kind) {
                ensureAudio();
                audioCtx.resume();
                
                // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯èª­ã¿è¾¼ã‚€
                if (!preloadStatus.isComplete) {
                    await preloadAudioFiles();
                }
                
                const builder = SOUND_BUILDERS[kind];
                if (!builder) {
                    console.error(`ä¸æ˜ãªéŸ³å£°ç¨®åˆ¥: ${kind}`);
                    return false;
                }
                
                // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®è­¦å‘Š
                if (!audioBuffers[kind]) {
                    alert(`éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« "${kind}.mp3" ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚soundsãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
                    return false;
                }
                
                const soundInstance = builder();
                if (soundInstance) {
                    activeSounds.set(kind, soundInstance);
                    return true;
                }
                return false;
            }
            
            function stopSound(kind) {
                if (kind) {
                    // ç‰¹å®šã®éŸ³æºã‚’åœæ­¢
                    const soundInstance = activeSounds.get(kind);
                    if (soundInstance) {
                        soundInstance.stopFn();
                        activeSounds.delete(kind);
                    }
                } else {
                    // å…¨ã¦ã®éŸ³æºã‚’åœæ­¢ï¼ˆæ—¢å­˜ã®æŒ™å‹•ç¶­æŒï¼‰
                    activeSounds.forEach((soundInstance) => {
                        soundInstance.stopFn();
                    });
                    activeSounds.clear();
                }
            }
            
            function isSoundPlaying(kind) {
                return activeSounds.has(kind);
            }
            
            // éŸ³é‡èª¿æ•´æ©Ÿèƒ½
            function setSoundVolume(kind, volume) {
                const soundInstance = activeSounds.get(kind);
                if (soundInstance && soundInstance.gainNode) {
                    soundInstance.gainNode.gain.value = Math.max(0, Math.min(1, volume));
                }
            }
            
            function setMasterVolume(volume) {
                if (masterGain) {
                    masterGain.gain.value = Math.max(0, Math.min(1, volume));
                }
            }
            
            // ç¾åœ¨å†ç”Ÿä¸­ã®éŸ³æºä¸€è¦§ã‚’å–å¾—
            function getActiveSounds() {
                return Array.from(activeSounds.keys());
            }
            
            // å‹•çš„è‰²å¤‰åŒ–ã‚·ã‚¹ãƒ†ãƒ 
            let soundVolumeData = new Map(); // soundName -> volumeLevel
            
            function updateButtonColors() {
                if (!analyser) return;
                
                // å…¨ä½“ã®éŸ³é‡ã‚’å–å¾—
                const timeArr = new Float32Array(analyser.fftSize);
                analyser.getFloatTimeDomainData(timeArr);
                let sum = 0;
                for (let i = 0; i < timeArr.length; i++) {
                    sum += timeArr[i] * timeArr[i];
                }
                const rms = Math.sqrt(sum / timeArr.length) || 1e-9;
                const dbfs = 20 * Math.log10(rms);
                
                // éŸ³é‡ã‚’0-1ã®ç¯„å›²ã«æ­£è¦åŒ–ï¼ˆ-60dBFS ï½ 0dBFSï¼‰
                const normalizedVolume = Math.max(0, Math.min(1, (dbfs + 60) / 60));
                
                // å†ç”Ÿä¸­ã®å„ãƒœã‚¿ãƒ³ã«è‰²å¤‰åŒ–ã‚’é©ç”¨
                btns.forEach((btn) => {
                    const soundName = btn.dataset.sound;
                    const isActive = btn.classList.contains('is-active');
                    
                    if (isActive) {
                        // éŸ³é‡ã«å¿œã˜ãŸã‚°ãƒ­ãƒ¼å¼·åº¦ï¼ˆ0.1 ï½ 0.8ï¼‰
                        const glowIntensity = 0.1 + (normalizedVolume * 0.7);
                        
                        // ãƒœã‚¿ãƒ³å€‹åˆ¥ã®CSSå¤‰æ•°ã‚’æ›´æ–°
                        btn.style.setProperty('--dynamic-glow-opacity', glowIntensity);
                        
                        // éŸ³é‡ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                        soundVolumeData.set(soundName, normalizedVolume);
                    } else {
                        // éã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚ã¯ã‚°ãƒ­ãƒ¼ã‚’ç„¡åŠ¹åŒ–
                        btn.style.setProperty('--dynamic-glow-opacity', '0');
                        soundVolumeData.delete(soundName);
                    }
                });
            }
            
            function setSoundColorTheme(soundName, intensity = 0.5) {
                const btn = document.querySelector(`[data-sound="${soundName}"]`);
                if (!btn) return;
                
                const baseIntensity = Math.max(0.1, Math.min(1, intensity));
                btn.style.setProperty('--dynamic-glow-opacity', baseIntensity);
            }
            
            // ãƒªãƒƒãƒ—ãƒ«åŠ¹æœã®å®Ÿè£…
            function createRipple(btn, event, options = {}) {
                const soundName = btn.dataset.sound;
                const soundColor = waveStyles[soundName]?.color || '#3a86ff';
                const rippleContainer = btn.querySelector('.ripple-container');
                
                if (!rippleContainer) return;
                
                const rect = btn.getBoundingClientRect();
                let x, y;
                
                if (options.randomPosition) {
                    // ä¸­å¿ƒä½ç½®ï¼ˆç¶™ç¶šæ³¢ç´‹ç”¨ï¼‰
                    x = rect.width / 2;
                    y = rect.height / 2;
                } else {
                    // ã‚¿ãƒƒãƒ/ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã‚’å–å¾—
                    let clientX, clientY;
                    
                    if (event && event.type === 'touchstart' && event.touches && event.touches[0]) {
                        clientX = event.touches[0].clientX;
                        clientY = event.touches[0].clientY;
                    } else if (event && event.clientX !== undefined) {
                        clientX = event.clientX;
                        clientY = event.clientY;
                    } else {
                        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒœã‚¿ãƒ³ä¸­å¤®
                        clientX = rect.left + rect.width / 2;
                        clientY = rect.top + rect.height / 2;
                    }
                    
                    x = clientX - rect.left;
                    y = clientY - rect.top;
                }
                
                // ãƒªãƒƒãƒ—ãƒ«è¦ç´ ã‚’ä½œæˆ
                const ripple = document.createElement('div');
                ripple.classList.add('ripple');
                
                // ã‚µã‚¤ã‚ºã¨ä½ç½®ã‚’è¨­å®š
                const baseSize = Math.max(rect.width, rect.height) * 0.6;
                const size = options.size ? baseSize * options.size : baseSize;
                const opacity = options.opacity || 1;
                
                ripple.style.width = size + 'px';
                ripple.style.height = size + 'px';
                ripple.style.left = (x - size / 2) + 'px';
                ripple.style.top = (y - size / 2) + 'px';
                ripple.style.background = `radial-gradient(circle, ${soundColor}${Math.floor(170 * opacity).toString(16).padStart(2, '0')}, ${soundColor}${Math.floor(102 * opacity).toString(16).padStart(2, '0')} 40%, transparent 70%)`;
                ripple.style.border = `1px solid ${soundColor}${Math.floor(136 * opacity).toString(16).padStart(2, '0')}`;
                
                // ã‚³ãƒ³ãƒ†ãƒŠã«è¿½åŠ 
                rippleContainer.appendChild(ripple);
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«å‰Šé™¤
                setTimeout(() => {
                    if (ripple.parentNode) {
                        ripple.parentNode.removeChild(ripple);
                    }
                }, 600);
            }
            
            // ç¶™ç¶šçš„æ³¢ç´‹åŠ¹æœã®åˆ¶å¾¡
            function startContinuousRipples(soundName) {
                const btn = document.querySelector(`[data-sound="${soundName}"]`);
                if (!btn) return;
                
                // æ—¢å­˜ã®æ³¢ç´‹ã‚’åœæ­¢
                stopContinuousRipples(soundName);
                
                // éŸ³æºç‰¹æ€§ã«å¿œã˜ãŸæ³¢ç´‹é–“éš”ã‚’è¨­å®š
                const style = waveStyles[soundName];
                let baseInterval = 1500; // åŸºæœ¬é–“éš”ï¼ˆãƒŸãƒªç§’ï¼‰
                
                // éŸ³æºã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦é–“éš”èª¿æ•´
                switch (style?.type) {
                    case 'spikes': // å·¥äº‹éŸ³
                        baseInterval = 800;
                        break;
                    case 'bars': // è©±ã—å£°ãƒ»äº¤é€šé¨’éŸ³
                        baseInterval = 1200;
                        break;
                    case 'dots': // é›¨éŸ³
                        baseInterval = 2000;
                        break;
                    case 'curve': // ãƒ†ãƒ¬ãƒ“ãƒ»æ´—æ¿¯æ©Ÿ
                        baseInterval = 1600;
                        break;
                }
                
                const intervalId = setInterval(() => {
                    // éŸ³é‡ã«å¿œã˜ãŸæ³¢ç´‹ã®å¼·åº¦ã‚’è¨ˆç®—
                    const volumeLevel = soundVolumeData.get(soundName) || 0.3;
                    const intensity = 0.3 + volumeLevel * 0.7; // 0.3-1.0ã®ç¯„å›²
                    
                    // ãƒ©ãƒ³ãƒ€ãƒ ãªå¤‰å‹•ã‚’åŠ ãˆã‚‹
                    const variation = 0.8 + Math.random() * 0.4; // 0.8-1.2ã®ç¯„å›²
                    const finalIntensity = Math.min(1, intensity * variation);
                    
                    // æ³¢ç´‹ã‚’ç”Ÿæˆ
                    createRipple(btn, null, {
                        randomPosition: true,
                        size: 0.4 + finalIntensity * 0.4, // ã‚µã‚¤ã‚ºèª¿æ•´
                        opacity: 0.4 + finalIntensity * 0.4 // é€æ˜åº¦èª¿æ•´
                    });
                }, baseInterval + Math.random() * 400 - 200); // Â±200msã®ãƒ©ãƒ³ãƒ€ãƒ å¤‰å‹•
                
                continuousRipples.set(soundName, intervalId);
            }
            
            function stopContinuousRipples(soundName) {
                const intervalId = continuousRipples.get(soundName);
                if (intervalId) {
                    clearInterval(intervalId);
                    continuousRipples.delete(soundName);
                }
            }
            
            // ã‚ªãƒ¼ãƒ©åŠ¹æœã®å‹•çš„åˆ¶å¾¡
            function updateAuraEffect(soundName, isActive) {
                const btn = document.querySelector(`[data-sound="${soundName}"]`);
                if (!btn) return;
                
                if (isActive) {
                    // éŸ³æºè‰²ã§ã‚ªãƒ¼ãƒ©ã‚’è¨­å®š
                    const soundColor = waveStyles[soundName]?.color || '#3a86ff';
                    btn.style.setProperty('--sound-base', soundColor);
                } else {
                    // ã‚ªãƒ¼ãƒ©ã‚’ç„¡åŠ¹åŒ–
                    btn.style.removeProperty('--sound-base');
                }
            }
            
            // ãƒŸãƒ‹æ³¢å½¢ã‚­ãƒ£ãƒ³ãƒã‚¹ã®åˆæœŸåŒ–ï¼ˆæœ€é©åŒ–ç‰ˆï¼‰
            function initMiniWaveCanvas(soundName) {
                const canvas = document.querySelector(`[data-wave="${soundName}"]`);
                if (!canvas) return null;
                
                const ctx = canvas.getContext('2d');
                
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã‚’è¨­å®šï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿DPRã‚’ä½¿ç”¨ï¼‰
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * devicePixelRatio;
                canvas.height = rect.height * devicePixelRatio;
                ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
                
                const dataArray = new Uint8Array(256); // 512 / 2
                
                const canvasData = {
                    canvas: canvas,
                    ctx: ctx,
                    dataArray: dataArray,
                    width: rect.width,
                    height: rect.height
                };
                
                miniWaveCanvases.set(soundName, canvasData);
                return canvasData;
            }
            
            // å…¨ãƒŸãƒ‹æ³¢å½¢ã‚­ãƒ£ãƒ³ãƒã‚¹ã®åˆæœŸåŒ–
            function initAllMiniWaveCanvases() {
                const sounds = ['voice', 'tv', 'construction', 'laundry', 'rain', 'traffic'];
                sounds.forEach(soundName => {
                    initMiniWaveCanvas(soundName);
                });
            }
            
            // dBè¡¨ç¤ºè¦ç´ ã®åˆæœŸåŒ–
            function initDBDisplayElements() {
                const sounds = ['voice', 'tv', 'construction', 'laundry', 'rain', 'traffic'];
                sounds.forEach(soundName => {
                    const dbElement = document.querySelector(`[data-db="${soundName}"]`);
                    if (dbElement) {
                        dbDisplayElements.set(soundName, dbElement);
                    }
                });
            }
            
            // éŸ³æºç‰¹æ€§åˆ¥ã®æ³¢å½¢æç”»ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ï¼ˆPhase1: æ„Ÿåº¦å‘ä¸Šï¼‰
            const waveStyles = {
                voice: {
                    type: 'curve',
                    color: '#ff6b6b',
                    intensity: 2.4,
                    smoothing: 0.7
                },
                tv: {
                    type: 'curve',
                    color: '#4ecdc4',
                    intensity: 1.8,
                    smoothing: 0.6
                },
                construction: {
                    type: 'curve',
                    color: '#ffa726',
                    intensity: 3.0,
                    smoothing: 0.3
                },
                laundry: {
                    type: 'curve',
                    color: '#ab47bc',
                    intensity: 2.2,
                    smoothing: 0.8
                },
                rain: {
                    type: 'curve',
                    color: '#42a5f5',
                    intensity: 1.6,
                    smoothing: 0.9
                },
                traffic: {
                    type: 'curve',
                    color: '#66bb6a',
                    intensity: 2.0,
                    smoothing: 0.5
                }
            };
            
            // å€‹åˆ¥éŸ³æºã®dBè¨ˆç®—
            function calculateSoundDB(soundName) {
                const soundInstance = activeSounds.get(soundName);
                if (!soundInstance) return null;
                
                const { analyser } = soundInstance;
                const timeArr = new Float32Array(analyser.fftSize);
                analyser.getFloatTimeDomainData(timeArr);
                
                // RMSå€¤è¨ˆç®—
                let sum = 0;
                for (let i = 0; i < timeArr.length; i++) {
                    sum += timeArr[i] * timeArr[i];
                }
                const rms = Math.sqrt(sum / timeArr.length) || 1e-9;
                
                // dBFSè¨ˆç®—ï¼ˆ-60dBFS ï½ 0dBFS ã®ç¯„å›²ï¼‰
                const dbfs = 20 * Math.log10(rms);
                return Math.max(-60, Math.min(0, dbfs));
            }
            
            // å€‹åˆ¥éŸ³æºã®dBè¡¨ç¤ºæ›´æ–°
            function updateSoundDBDisplay(soundName, dbValue) {
                const dbElement = dbDisplayElements.get(soundName);
                if (!dbElement) return;
                
                if (dbValue !== null) {
                    // dBå€¤ã‚’æ•´æ•°ã§è¡¨ç¤ºï¼ˆ-âˆ ã®å ´åˆã¯ç‰¹åˆ¥å‡¦ç†ï¼‰
                    if (dbValue <= -60) {
                        dbElement.textContent = '-âˆ';
                    } else {
                        dbElement.textContent = Math.round(dbValue) + 'dB';
                    }
                } else {
                    dbElement.textContent = '-âˆ';
                }
            }
            
            // å€‹åˆ¥éŸ³æºã®æ³¢å½¢æç”»ï¼ˆæœ€é©åŒ–ç‰ˆï¼‰
            function drawMiniWave(soundName) {
                const soundInstance = activeSounds.get(soundName);
                const canvasData = miniWaveCanvases.get(soundName);
                const style = waveStyles[soundName];
                
                if (!soundInstance || !canvasData || !style) return;
                
                const { analyser } = soundInstance;
                const { ctx, dataArray, width, height } = canvasData;
                
                // å‘¨æ³¢æ•°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                analyser.getByteFrequencyData(dataArray);
                
                // éŸ³æºç‰¹æ€§ã«å¿œã˜ãŸæç”»ï¼ˆã‚¯ãƒªã‚¢ã¯å„æç”»é–¢æ•°å†…ã§å¿…è¦ã«å¿œã˜ã¦å®Ÿè¡Œï¼‰
                switch (style.type) {
                    case 'bars':
                        drawBars(ctx, dataArray, width, height, style);
                        break;
                    case 'curve':
                        drawCurve(ctx, dataArray, width, height, style);
                        break;
                    case 'spikes':
                        drawSpikes(ctx, dataArray, width, height, style);
                        break;
                    case 'dots':
                        drawDots(ctx, dataArray, width, height, style);
                        break;
                }
                
                // dBå€¤ã®è¨ˆç®—ã¨è¡¨ç¤º
                const dbValue = calculateSoundDB(soundName);
                updateSoundDBDisplay(soundName, dbValue);
            }
            
            // ãƒãƒ¼å½¢å¼ã®æ³¢å½¢æç”»ï¼ˆè©±ã—å£°ãƒ»äº¤é€šé¨’éŸ³ï¼‰æœ€é©åŒ–ç‰ˆ
            function drawBars(ctx, dataArray, width, height, style) {
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªã‚¢ï¼ˆãƒãƒ¼æç”»ã§ã¯å¿…è¦ï¼‰
                ctx.clearRect(0, 0, width, height);
                
                const barCount = 12;
                const barWidth = width / barCount;
                const step = Math.floor(dataArray.length / barCount);
                const barWidthInner = barWidth * 0.6;
                const barWidthOffset = barWidth * 0.2;
                const heightScale = height * 0.95;
                
                ctx.fillStyle = style.color;
                
                for (let i = 0; i < barCount; i++) {
                    let value = 0;
                    for (let j = 0; j < step; j++) {
                        value += dataArray[i * step + j];
                    }
                    value = (value / step / 255) * style.intensity;
                    
                    const barHeight = value * heightScale;
                    const x = i * barWidth + barWidthOffset;
                    const y = height - barHeight;
                    
                    ctx.globalAlpha = 0.6 + value * 0.4;
                    ctx.fillRect(x, y, barWidthInner, barHeight);
                }
                ctx.globalAlpha = 1;
            }
            
            // ã‚«ãƒ¼ãƒ–å½¢å¼ã®æ³¢å½¢æç”»ï¼ˆã‚¹ãƒ ãƒ¼ã‚ºãªã‚¹ãƒ—ãƒ©ã‚¤ãƒ³æ›²ç·šï¼‰æœ€é©åŒ–ç‰ˆ
            function drawCurve(ctx, dataArray, width, height, style) {
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªã‚¢ï¼ˆã‚«ãƒ¼ãƒ–æç”»ã§ã¯å¿…è¦ï¼‰
                ctx.clearRect(0, 0, width, height);
                
                const points = 24;
                const step = Math.floor(dataArray.length / points);
                const heightCenter = height * 0.5;
                const heightRange = height * 0.9;
                const intensitySmoothing = style.intensity * style.smoothing;
                
                // ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’åé›†
                const values = [];
                for (let i = 0; i < points; i++) {
                    let value = 0;
                    for (let j = 0; j < step; j++) {
                        value += dataArray[i * step + j];
                    }
                    value = (value / step / 255) * intensitySmoothing;
                    values.push(value);
                }
                
                // ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
                ctx.strokeStyle = style.color;
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.globalAlpha = 0.9;
                
                // ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¹ãƒ—ãƒ©ã‚¤ãƒ³æ›²ç·šã‚’æç”»
                ctx.beginPath();
                
                for (let i = 0; i < points; i++) {
                    const x = (i / (points - 1)) * width;
                    const y = heightCenter + (values[i] - 0.5) * heightRange;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        // å‰ã®ãƒã‚¤ãƒ³ãƒˆã¨ã®ä¸­é–“ç‚¹ã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆ
                        const prevX = ((i - 1) / (points - 1)) * width;
                        const prevY = heightCenter + (values[i - 1] - 0.5) * heightRange;
                        const cpX = (prevX + x) * 0.5;
                        
                        ctx.quadraticCurveTo(cpX, prevY, x, y);
                    }
                }
                
                ctx.stroke();
                ctx.globalAlpha = 1;
            }
            
            // ã‚¹ãƒ‘ã‚¤ã‚¯å½¢å¼ã®æ³¢å½¢æç”»ï¼ˆå·¥äº‹éŸ³ï¼‰æœ€é©åŒ–ç‰ˆ
            function drawSpikes(ctx, dataArray, width, height, style) {
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªã‚¢ï¼ˆã‚¹ãƒ‘ã‚¤ã‚¯æç”»ã§ã¯å¿…è¦ï¼‰
                ctx.clearRect(0, 0, width, height);
                
                const spikeCount = 16;
                const spikeWidth = width / spikeCount;
                const step = Math.floor(dataArray.length / spikeCount);
                const spikeOffset = spikeWidth * 0.5;
                const heightScale = height * 0.95;
                
                ctx.strokeStyle = style.color;
                ctx.lineWidth = 2;
                
                for (let i = 0; i < spikeCount; i++) {
                    const value = dataArray[i * step] / 255 * style.intensity;
                    const x = i * spikeWidth + spikeOffset;
                    const spikeHeight = value * heightScale;
                    
                    ctx.globalAlpha = 0.5 + value * 0.5;
                    ctx.beginPath();
                    ctx.moveTo(x, height);
                    ctx.lineTo(x, height - spikeHeight);
                    ctx.stroke();
                }
                ctx.globalAlpha = 1;
            }
            
            // ãƒ‰ãƒƒãƒˆå½¢å¼ã®æ³¢å½¢æç”»ï¼ˆé›¨éŸ³ï¼‰æœ€é©åŒ–ç‰ˆ
            function drawDots(ctx, dataArray, width, height, style) {
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªã‚¢ï¼ˆãƒ‰ãƒƒãƒˆæç”»ã§ã¯å¿…è¦ï¼‰
                ctx.clearRect(0, 0, width, height);
                
                const dotCount = 24;
                const step = Math.floor(dataArray.length / dotCount);
                const heightBase = height * 0.1;
                const heightRange = height * 0.8;
                const twoPi = Math.PI * 2;
                
                ctx.fillStyle = style.color;
                
                for (let i = 0; i < dotCount; i++) {
                    const value = dataArray[i * step] / 255 * style.intensity;
                    
                    const x = (i / dotCount) * width + Math.random() * 3 - 1.5;
                    const y = heightBase + value * heightRange + Math.random() * 2 - 1;
                    const radius = 0.5 + value * 1.5;
                    
                    ctx.globalAlpha = 0.4 + value * 0.6;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, twoPi);
                    ctx.fill();
                }
                ctx.globalAlpha = 1;
            }

            // ã‚¿ãƒƒãƒåŠ¹æœã¨ãƒªãƒƒãƒ—ãƒ«åŠ¹æœã®çµ±åˆç®¡ç†
            function addTouchEffects(btn) {
                let touchTimeout = null;
                
                // ã‚¿ãƒƒãƒé–‹å§‹æ™‚ï¼ˆãƒªãƒƒãƒ—ãƒ«åŠ¹æœä»˜ãï¼‰
                function handleTouchStart(e) {
                    // é‡è¤‡é˜²æ­¢
                    if (touchTimeout) clearTimeout(touchTimeout);
                    
                    // å³åº§ã«ã‚¿ãƒƒãƒçŠ¶æ…‹é©ç”¨
                    btn.classList.add('touching');
                    
                    // ãƒªãƒƒãƒ—ãƒ«åŠ¹æœã‚’ä½œæˆ
                    createRipple(btn, e);
                    
                    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç¨€ã«touchendãŒç™ºç«ã—ãªã„å ´åˆã®å¯¾ç­–ï¼‰
                    touchTimeout = setTimeout(() => {
                        btn.classList.remove('touching');
                    }, 300);
                }
                
                // ã‚¿ãƒƒãƒçµ‚äº†æ™‚
                function handleTouchEnd(e) {
                    if (touchTimeout) {
                        clearTimeout(touchTimeout);
                        touchTimeout = null;
                    }
                    btn.classList.remove('touching');
                }
                
                // ãƒã‚¦ã‚¹ãƒ€ã‚¦ãƒ³æ™‚ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å¯¾å¿œï¼‰
                function handleMouseDown(e) {
                    if (!('ontouchstart' in window)) { // ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ã§ãªã„å ´åˆã®ã¿
                        btn.classList.add('touching');
                        // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã‚‚ãƒªãƒƒãƒ—ãƒ«åŠ¹æœ
                        createRipple(btn, e);
                    }
                }
                
                // ãƒã‚¦ã‚¹ã‚¢ãƒƒãƒ—ãƒ»ãƒã‚¦ã‚¹ãƒªãƒ¼ãƒ–æ™‚
                function handleMouseUp(e) {
                    btn.classList.remove('touching');
                }
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ ï¼ˆpassive ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ€§èƒ½å‘ä¸Šï¼‰
                btn.addEventListener('touchstart', handleTouchStart, { passive: true });
                btn.addEventListener('touchend', handleTouchEnd, { passive: true });
                btn.addEventListener('touchcancel', handleTouchEnd, { passive: true });
                
                btn.addEventListener('mousedown', handleMouseDown);
                btn.addEventListener('mouseup', handleMouseUp);
                btn.addEventListener('mouseleave', handleMouseUp);
                
                // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’è¿”ã™
                return () => {
                    if (touchTimeout) clearTimeout(touchTimeout);
                    btn.removeEventListener('touchstart', handleTouchStart);
                    btn.removeEventListener('touchend', handleTouchEnd);
                    btn.removeEventListener('touchcancel', handleTouchEnd);
                    btn.removeEventListener('mousedown', handleMouseDown);
                    btn.removeEventListener('mouseup', handleMouseUp);
                    btn.removeEventListener('mouseleave', handleMouseUp);
                };
            }

            // UIã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ï¼ˆè¤‡æ•°éŸ³æºåŒæ™‚å†ç”Ÿå¯¾å¿œï¼‰
            const btns = Array.from(document.querySelectorAll(".sound-btn"));
            btns.forEach((btn) => {
                // ã‚¿ãƒƒãƒåŠ¹æœã‚’è¿½åŠ 
                addTouchEffects(btn);
                
                btn.addEventListener("click", async () => {
                    const kind = btn.dataset.sound;
                    const isActive = btn.classList.contains("is-active");
                    
                    // ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¦ã„ãªã„å ´åˆã¯ã‚¯ãƒªãƒƒã‚¯ã‚’ç„¡è¦–
                    if (!preloadStatus.isComplete) {
                        console.log('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“');
                        return;
                    }
                    
                    if (isActive) {
                        // å†ç”Ÿä¸­ã®éŸ³æºã‚’åœæ­¢
                        stopSound(kind);
                        btn.classList.remove("is-active");
                        btn.setAttribute("aria-pressed", "false");
                        // è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
                        btn.style.setProperty('--dynamic-glow-opacity', '0');
                        // ã‚ªãƒ¼ãƒ©åŠ¹æœã‚’ç„¡åŠ¹åŒ–
                        updateAuraEffect(kind, false);
                        // ç¶™ç¶šæ³¢ç´‹ã‚’åœæ­¢
                        stopContinuousRipples(kind);
                    } else {
                        // ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å³åº§ã«ã€Œã“ã“ã‚’ã‚¿ãƒƒãƒ—ï¼ã€ã‚’éè¡¨ç¤º
                        const tapMessage = btn.querySelector('.tap-message');
                        if (tapMessage) {
                            tapMessage.style.opacity = '0';
                            tapMessage.style.visibility = 'hidden';
                        }
                        
                        // æ–°ã—ã„éŸ³æºã‚’é–‹å§‹
                        try {
                            const success = await startSound(kind);
                            if (success) {
                                btn.classList.add("is-active");
                                btn.setAttribute("aria-pressed", "true");
                                // åˆæœŸã‚°ãƒ­ãƒ¼è¨­å®š
                                btn.style.setProperty('--dynamic-glow-opacity', '0.3');
                                // ã‚ªãƒ¼ãƒ©åŠ¹æœã‚’æœ‰åŠ¹åŒ–
                                updateAuraEffect(kind, true);
                                // ç¶™ç¶šæ³¢ç´‹ã‚’é–‹å§‹
                                startContinuousRipples(kind);
                                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹ï¼ˆæœ€åˆã®éŸ³æºã®å ´åˆï¼‰
                                if (activeSounds.size === 1) {
                                    draw();
                                }
                            } else {
                                // éŸ³å£°å†ç”Ÿã«å¤±æ•—ã—ãŸå ´åˆã¯ã€Œã“ã“ã‚’ã‚¿ãƒƒãƒ—ï¼ã€ã‚’å†è¡¨ç¤º
                                if (tapMessage) {
                                    tapMessage.style.opacity = '';
                                    tapMessage.style.visibility = '';
                                }
                            }
                        } catch (error) {
                            console.error('éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);
                            btn.classList.remove("is-active");
                            btn.setAttribute("aria-pressed", "false");
                            btn.style.setProperty('--dynamic-glow-opacity', '0');
                            updateAuraEffect(kind, false);
                            stopContinuousRipples(kind);
                            // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã€Œã“ã“ã‚’ã‚¿ãƒƒãƒ—ï¼ã€ã‚’å†è¡¨ç¤º
                            if (tapMessage) {
                                tapMessage.style.opacity = '';
                                tapMessage.style.visibility = '';
                            }
                            alert('éŸ³å£°ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                        }
                    }
                });
            });

            // æœ€é©åŒ–ã•ã‚ŒãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ï¼ˆéŸ³æºå†ç”Ÿä¸­ã®ã¿å®Ÿè¡Œï¼‰
            function draw() {
                // éŸ³æºãŒå†ç”Ÿä¸­ã®æ™‚ã ã‘æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
                if (analyser && activeSounds.size > 0) {
                    requestAnimationFrame(draw);
                    
                    // å‹•çš„è‰²å¤‰åŒ–ã®æ›´æ–°
                    updateButtonColors();
                    
                    // å€‹åˆ¥éŸ³æºã®æ³¢å½¢æç”»
                    activeSounds.forEach((soundInstance, soundName) => {
                        drawMiniWave(soundName);
                    });
                }
            }


            window.addEventListener("pagehide", () => {
                stopSound(); // å…¨éŸ³æºåœæ­¢
                // å…¨ç¶™ç¶šæ³¢ç´‹ã‚’åœæ­¢
                continuousRipples.forEach((intervalId, soundName) => {
                    clearInterval(intervalId);
                });
                continuousRipples.clear();
            });

            // PWAé–¢é€£ã®æ©Ÿèƒ½
            let deferredPrompt = null;
            let isServiceWorkerReady = false;

            // Service Workerã®ç™»éŒ²
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', async () => {
                    try {
                        const registration = await navigator.serviceWorker.register('./sw.js');
                        console.log('Service Worker registered successfully:', registration.scope);
                        
                        // Service Workerã®æº–å‚™å®Œäº†ã‚’å¾…ã¤
                        if (registration.active) {
                            isServiceWorkerReady = true;
                        } else {
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'activated') {
                                        isServiceWorkerReady = true;
                                        console.log('Service Worker is now active');
                                    }
                                });
                            });
                        }
                    } catch (error) {
                        console.error('Service Worker registration failed:', error);
                    }
                });
            }

            // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å‡¦ç†
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('PWA install prompt triggered');
                e.preventDefault();
                deferredPrompt = e;
                showInstallButton();
            });

            // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã®è¡¨ç¤º
            function showInstallButton() {
                // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ãŒã¾ã å­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
                if (!document.getElementById('installButton')) {
                    const installBtn = document.createElement('button');
                    installBtn.id = 'installButton';
                    installBtn.innerHTML = 'ğŸ“± ã‚¢ãƒ—ãƒªã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«';
                    installBtn.className = 'chip install-btn';
                    installBtn.style.cssText = `
                        margin-left: 8px;
                        cursor: pointer;
                        background: linear-gradient(145deg, #e8f2ff, #f0f7ff);
                        color: var(--accent);
                        border: none;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        animation: gentle-pulse 2s ease-in-out infinite;
                    `;
                    
                    installBtn.addEventListener('click', installApp);
                    
                    // topbarã«è¿½åŠ 
                    const spacer = document.querySelector('.topbar .spacer');
                    if (spacer) {
                        spacer.parentNode.insertBefore(installBtn, spacer);
                    }
                }
            }

            // ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡¦ç†
            async function installApp() {
                if (!deferredPrompt) return;
                
                const installBtn = document.getElementById('installButton');
                if (installBtn) {
                    installBtn.textContent = 'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­...';
                    installBtn.disabled = true;
                }
                
                try {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        console.log('PWA install accepted');
                        if (installBtn) {
                            installBtn.textContent = 'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ï¼';
                            setTimeout(() => {
                                installBtn.style.display = 'none';
                            }, 2000);
                        }
                    } else {
                        console.log('PWA install dismissed');
                        if (installBtn) {
                            installBtn.textContent = 'ğŸ“± ã‚¢ãƒ—ãƒªã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«';
                            installBtn.disabled = false;
                        }
                    }
                } catch (error) {
                    console.error('PWA install error:', error);
                    if (installBtn) {
                        installBtn.textContent = 'ğŸ“± ã‚¢ãƒ—ãƒªã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«';
                        installBtn.disabled = false;
                    }
                }
                
                deferredPrompt = null;
            }

            // ã‚¢ãƒ—ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã®å ´åˆã¯ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
            window.addEventListener('appinstalled', () => {
                console.log('PWA was installed');
                const installBtn = document.getElementById('installButton');
                if (installBtn) {
                    installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            });

            // Service Workerã¨ã®é€šä¿¡ï¼ˆéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥è¦æ±‚ï¼‰
            async function requestAudioPreCache() {
                if (!('serviceWorker' in navigator) || !navigator.serviceWorker.controller) {
                    return;
                }

                try {
                    const messageChannel = new MessageChannel();
                    navigator.serviceWorker.controller.postMessage(
                        { type: 'PRECACHE_AUDIO' },
                        [messageChannel.port2]
                    );

                    return new Promise((resolve, reject) => {
                        messageChannel.port1.onmessage = (event) => {
                            if (event.data.success) {
                                console.log('Audio files pre-cached successfully');
                                resolve();
                            } else {
                                console.error('Audio pre-cache failed:', event.data.error);
                                reject(new Error(event.data.error));
                            }
                        };
                    });
                } catch (error) {
                    console.error('Failed to request audio pre-cache:', error);
                }
            }

            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰
            window.addEventListener("DOMContentLoaded", () => {
                // ãƒŸãƒ‹æ³¢å½¢ã‚­ãƒ£ãƒ³ãƒã‚¹ã®åˆæœŸåŒ–
                initAllMiniWaveCanvases();
                
                // dBè¡¨ç¤ºè¦ç´ ã®åˆæœŸåŒ–
                initDBDisplayElements();
                
                // åˆæœŸçŠ¶æ…‹ã‚’è¡¨ç¤º
                updatePreloadStatus();
                
                // åˆæœŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã‚’ç¢ºèª
                checkInitialNetworkState();
                
                // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«çŠ¶æ³è¡¨ç¤ºï¼‰
                preloadAudioFiles().catch(error => {
                    console.error('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                    
                    // ã‚¨ãƒ©ãƒ¼æ™‚ã®è¡¨ç¤º
                    const loadingLabel = document.getElementById('loadingLabel');
                    const loadingDot = document.querySelector('.loading-dot');
                    const loadingProgress = document.getElementById('loadingProgress');
                    
                    if (loadingLabel && loadingDot && loadingProgress) {
                        loadingLabel.textContent = 'èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼';
                        loadingDot.style.background = 'radial-gradient(circle at 30% 30%, #ffd8d8, #ff5a5f)';
                        loadingProgress.textContent = 'ã‚¨ãƒ©ãƒ¼';
                    }
                    
                    // ã‚¨ãƒ©ãƒ¼ã§ã‚‚ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§è©¦ã›ã‚‹ã‚ˆã†ã«ï¼‰
                    setTimeout(() => {
                        enableAllSoundButtons();
                        
                        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°
                        if (loadingLabel) {
                            loadingLabel.textContent = 'æ‰‹å‹•ã§ãŠè©¦ã—ãã ã•ã„';
                        }
                    }, 3000);
                });
            });
        </script>
    </body>
</html>
